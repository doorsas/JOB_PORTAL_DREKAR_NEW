{% extends 'core/base1.html' %}
{% load i18n %}

{% block title %}{{ job.title }} - {{ block.super }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8">
            <!-- Job Details Card -->
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h3 class="card-title mb-1">{{ job.title }}</h3>
                            <h5 class="text-muted mb-0">
                                <i class="fas fa-building me-2"></i>{{ job.employer.company_name }}
                            </h5>
                        </div>
                        {% if user_applied %}
                            <span class="badge bg-success fs-6">
                                <i class="fas fa-check me-1"></i>{% trans "Applied" %}
                            </span>
                        {% endif %}
                    </div>
                </div>
                <div class="card-body">
                    <!-- Job Summary -->
                    <div class="job-summary row mb-4">
                        <div class="col-md-6">
                            <div class="info-item mb-2">
                                <i class="fas fa-map-marker-alt text-primary me-2"></i>
                                <strong>{% trans "Location:" %}</strong> {{ job.location }}
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-briefcase text-primary me-2"></i>
                                <strong>{% trans "Job Type:" %}</strong> {{ job.get_job_type_display }}
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-users text-primary me-2"></i>
                                <strong>{% trans "Positions:" %}</strong> {{ job.num_employees_requested }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            {% if job.estimated_salary_min or job.estimated_salary_max %}
                            <div class="info-item mb-2">
                                <i class="fas fa-euro-sign text-primary me-2"></i>
                                <strong>{% trans "Salary:" %}</strong>
                                {% if job.estimated_salary_min and job.estimated_salary_max %}
                                    €{{ job.estimated_salary_min|floatformat:0 }} - €{{ job.estimated_salary_max|floatformat:0 }}
                                {% elif job.estimated_salary_min %}
                                    {% trans "From" %} €{{ job.estimated_salary_min|floatformat:0 }}
                                {% elif job.estimated_salary_max %}
                                    {% trans "Up to" %} €{{ job.estimated_salary_max|floatformat:0 }}
                                {% endif %}
                            </div>
                            {% endif %}
                            <div class="info-item mb-2">
                                <i class="fas fa-calendar text-primary me-2"></i>
                                <strong>{% trans "Posted:" %}</strong> {{ job.created_at|date:"M d, Y" }}
                            </div>
                            {% if job.closing_date %}
                            <div class="info-item mb-2">
                                <i class="fas fa-clock text-primary me-2"></i>
                                <strong>{% trans "Deadline:" %}</strong> {{ job.closing_date|date:"M d, Y" }}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Job Description -->
                    <h5 class="mb-3">{% trans "Job Description" %}</h5>
                    <div class="job-description mb-4">
                        {{ job.description|linebreaks }}
                    </div>

                    <!-- Required Qualifications -->
                    {% if job.required_qualifications.exists %}
                    <h5 class="mb-3">{% trans "Required Qualifications" %}</h5>
                    <div class="qualifications mb-4">
                        <ul class="list-unstyled">
                            {% for qualification in job.required_qualifications.all %}
                            <li class="mb-1">
                                <i class="fas fa-graduation-cap text-primary me-2"></i>
                                {{ qualification.name }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <!-- Required Skills -->
                    {% if job.required_skills.exists %}
                    <h5 class="mb-3">{% trans "Required Skills" %}</h5>
                    <div class="skills mb-4">
                        {% for skill in job.required_skills.all %}
                            <span class="badge bg-secondary me-2 mb-2">{{ skill.name }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <!-- Application Status -->
                    {% if user_applied %}
                    <div class="alert alert-success">
                        <h6 class="alert-heading">
                            <i class="fas fa-check-circle me-2"></i>{% trans "Application Submitted" %}
                        </h6>
                        <p class="mb-2">
                            {% trans "You applied for this position on" %} {{ application.created_at|date:"M d, Y" }}.
                        </p>
                        <p class="mb-2">
                            <strong>{% trans "Status:" %}</strong>
                            <span class="badge
                                {% if application.status == 'SUBMITTED' %}bg-primary
                                {% elif application.status == 'REVIEWED' %}bg-info
                                {% elif application.status == 'INVITED' %}bg-warning
                                {% elif application.status == 'HIRED' %}bg-success
                                {% elif application.status == 'REJECTED' %}bg-danger
                                {% elif application.status == 'RESERVED' %}bg-secondary
                                {% endif %}">
                                {{ application.get_status_display }}
                            </span>
                        </p>
                        {% if application.status in 'SUBMITTED,REVIEWED' %}
                        <a href="{% url 'employees:withdraw_application' application.id %}" class="btn btn-outline-danger btn-sm">
                            {% trans "Withdraw Application" %}
                        </a>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Action Buttons -->
                    <div class="action-buttons d-flex gap-3 mt-4">
                        <a href="{% url 'employees:job_search' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> {% trans "Back to Search" %}
                        </a>

                        {% if not user_applied and has_profile %}
                            <a href="{% url 'employees:apply_for_job' job.id %}" class="btn btn-success btn-lg">
                                <i class="fas fa-paper-plane"></i> {% trans "Apply for This Job" %}
                            </a>
                        {% elif not has_profile %}
                            <a href="{% url 'employees:profile_setup' %}" class="btn btn-warning">
                                <i class="fas fa-user-plus"></i> {% trans "Complete Profile to Apply" %}
                            </a>
                        {% else %}
                            <button class="btn btn-secondary" disabled>
                                <i class="fas fa-check"></i> {% trans "Already Applied" %}
                            </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Company Information -->
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="card-title mb-0">{% trans "Company Information" %}</h6>
                </div>
                <div class="card-body">
                    <h6>{{ job.employer.company_name }}</h6>
                    {% if job.employer.address %}
                    <p class="text-muted mb-2">
                        <i class="fas fa-map-marker-alt me-2"></i>{{ job.employer.address }}
                    </p>
                    {% endif %}
                    {% if job.employer.website %}
                    <p class="mb-2">
                        <a href="{{ job.employer.website }}" target="_blank" rel="noopener noreferrer">
                            <i class="fas fa-external-link-alt me-2"></i>{% trans "Visit Website" %}
                        </a>
                    </p>
                    {% endif %}
                    {% if job.employer.phone %}
                    <p class="text-muted mb-0">
                        <i class="fas fa-phone me-2"></i>{{ job.employer.phone }}
                    </p>
                    {% endif %}
                </div>
            </div>

            <!-- Application Tips -->
            {% if not user_applied and has_profile %}
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="card-title mb-0">{% trans "Application Tips" %}</h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="fas fa-lightbulb text-warning me-2"></i>
                            <small>{% trans "Tailor your cover letter to this specific role" %}</small>
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-lightbulb text-warning me-2"></i>
                            <small>{% trans "Highlight relevant skills and experience" %}</small>
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-lightbulb text-warning me-2"></i>
                            <small>{% trans "Research the company before applying" %}</small>
                        </li>
                        <li class="mb-0">
                            <i class="fas fa-lightbulb text-warning me-2"></i>
                            <small>{% trans "Ensure your CV is up to date" %}</small>
                        </li>
                    </ul>
                </div>
            </div>
            {% endif %}

            <!-- Similar Jobs -->
            {% if similar_jobs %}
            <div class="card">
                <div class="card-header">
                    <h6 class="card-title mb-0">{% trans "Similar Jobs" %}</h6>
                </div>
                <div class="card-body">
                    {% for similar_job in similar_jobs %}
                    <div class="similar-job mb-3 {% if not forloop.last %}border-bottom pb-3{% endif %}">
                        <h6 class="mb-1">
                            <a href="{% url 'employees:job_detail' similar_job.id %}" class="text-decoration-none">
                                {{ similar_job.title }}
                            </a>
                        </h6>
                        <p class="text-muted mb-1 small">{{ similar_job.employer.company_name }}</p>
                        <p class="text-muted mb-0 small">
                            <i class="fas fa-map-marker-alt me-1"></i>{{ similar_job.location }}
                        </p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Custom CSS -->
<style>
    .card {
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border: 1px solid #e3e6f0;
    }

    .card-header {
        background-color: #f8f9fc;
        border-bottom: 1px solid #e3e6f0;
    }

    .info-item i {
        width: 16px;
    }

    .job-description {
        line-height: 1.6;
    }

    .skills .badge {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
    }

    .qualifications ul li {
        padding: 0.25rem 0;
    }

    .similar-job:hover h6 a {
        color: #3498db !important;
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
        .d-flex.gap-3 {
            flex-direction: column;
            gap: 1rem !important;
        }

        .action-buttons .btn {
            width: 100%;
        }

        .job-summary .col-md-6 {
            margin-bottom: 1rem;
        }
    }
</style>
{% endblock %}